# 股票規則檢查系統 - 主程序使用說明

## 概述

本系統提供了一個完整的股票技術分析流程，通過串接四個核心模組來實現從數據收集到規則總結的全自動化處理。

## 系統架構

主程序 `main.py` 按順序執行以下四個步驟：

### 步驟1: 收集K線數據 (`kbar_collector.py`)
- 根據 `config/stklist.cfg` 中的股票清單收集日K和週K數據
- 自動檢查數據更新狀態，避免重複下載
- 輸出位置：`Data/kbar/`

### 步驟2: 添加技術指標 (`append_indicator.py`)
- 為K線數據添加技術指標：KD、MACD、移動平均線
- 處理日K和週K數據文件
- 指標數據精確到小數點後兩位

### 步驟3: 驗證買入規則 (`validate_buy_rule.py`)
- 應用多種買入規則：三陽開泰、四海游龍、MACD黃金交叉等
- 生成K線圖表，標記買入信號點
- 輸出位置：
  - 規則結果：`output/buy_rules/`
  - K線圖表：`output/chart/`

### 步驟4: 總結買入規則 (`summarize_buy_rules.py`)
- 彙總所有股票的最新規則檢查結果
- 生成總結報表
- 輸出位置：`output/buy_rules_summary.csv`

## 使用方法

### 前置準備

1. 確保已安裝所需的Python套件：
   ```bash
   pip install -r requirements.txt
   ```

2. 配置股票清單文件 `config/stklist.cfg`：
   ```
   股票代碼,股票名稱
   2330,台積電
   2317,鴻海
   ...
   ```

3. 配置API金鑰（如果需要）：
   - 編輯 `config/shioaji_keys.yaml`

### 執行主程序

```bash
# 在專案根目錄執行
python main.py
```

### 執行結果

程序執行完成後，會在以下位置生成結果文件：

```
StkRuleCheck/
├── Data/kbar/              # K線數據文件
│   ├── 2330_D.csv         # 日K數據
│   ├── 2330_W.csv         # 週K數據
│   └── ...
├── output/
│   ├── buy_rules/         # 規則驗證結果
│   │   ├── 2330_D_Rule.csv
│   │   └── ...
│   ├── chart/             # K線圖表
│   │   ├── 2330_validation_chart.png
│   │   └── ...
│   └── buy_rules_summary.csv  # 總結報表
```

## 功能特點

- **自動化流程**：一鍵執行完整的股票分析流程
- **錯誤處理**：單個步驟失敗不會中斷整個流程
- **進度顯示**：實時顯示執行進度和狀態
- **結果總結**：提供詳細的執行結果和輸出文件位置
- **增量更新**：智能檢測數據更新需求，避免重複下載

## 注意事項

1. 首次執行可能需要較長時間，因為需要下載所有股票的歷史數據
2. 確保網路連接穩定，以便順利下載股票數據
3. 如果某支股票處理失敗，程序會繼續處理其他股票
4. 建議定期執行以保持數據更新

## 故障排除

- **數據下載失敗**：檢查網路連接和API配置
- **圖表生成失敗**：確保已安裝matplotlib和相關字體
- **規則檢查錯誤**：檢查數據文件格式和完整性

## 自定義配置

可以通過修改各個子模組的參數來自定義系統行為：
- 修改下載天數：編輯 `kbar_collector.py` 中的 `DOWNLOAD_DAYS`
- 調整技術指標參數：編輯相關計算模組
- 添加新的買入規則：在 `src/buyRule/` 目錄下添加新規則